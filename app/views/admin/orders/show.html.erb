<%# app/views/admin/orders/show.html.erb %>

<div class="back-link">
  <%= link_to "← Назад до списку замовлень", admin_orders_path, class: "muted" %>
</div>

<div class="checkout-layout">
  
  <%# Ліва частина: Деталі замовлення %>
  <div class="item-card item-card--dark item-card--padded">
    <h1 class="section-title">
      ЗАМОВЛЕННЯ №<%= @order.id.to_s.first(8).upcase %>
    </h1>

    <div class="form-row">
      <h3 class="section-title" style="border-bottom: none; padding-bottom: 0;">Склад замовлення:</h3>
      <table class="table--full" style="margin-top: 15px;">
        <thead>
          <tr>
            <th style="padding: 10px;">Товар</th>
            <th style="padding: 10px;">Кількість</th>
            <th style="padding: 10px;">Ціна (за од.)</th>
            <th style="padding: 10px;">Сума</th>
          </tr>
        </thead>
        <tbody>
          <% @order_items.each do |oi| %>
            <tr class="table-row">
              <td style="padding: 10px;"><%= oi.item.name %></td>
              <td style="padding: 10px;"><%= oi.quantity %></td>
              <td style="padding: 10px;"><%= number_to_currency(oi.price_at_purchase, unit: "₴") %></td>
              <td style="padding: 10px; font-weight: bold;"><%= number_to_currency(oi.price_at_purchase * oi.quantity, unit: "₴") %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
      <div style="text-align: right; margin-top: 20px; font-size: 1.5rem; font-weight: bold;">
        РАЗОМ: <span class="price"><%= number_to_currency(@order.total_price, unit: "₴") %></span>
      </div>
    </div>
  </div>

  <%# Права частина: Дані клієнта та Керування %>
  <aside>
    <div class="item-card item-card--aside">
      <h3 class="section-title" style="border-bottom: none; padding-bottom: 0;">Дані для доставки:</h3>
      <p><strong>Клієнт:</strong> <%= @order.full_name %></p>
      <p><strong>Телефон:</strong> <%= @order.phone %></p>
      <p><strong>Адреса:</strong> <%= @order.address %></p>
      <p><strong>Email:</strong> <%= @order.user.email %></p>
    </div>

    <div class="item-card item-card--controls">
      <h3 class="section-title" style="border-bottom: none; padding-bottom: 0;">Змінити статус:</h3>
      <%= form_with(model: [:admin, @order], local: true, method: :patch) do |f| %>
        <%= f.select :status, Order.statuses.keys.map { |s| [s.upcase, s] }, {}, { class: "form-control form-control--select", onchange: "this.form.submit()" } %>
        <%= f.submit "ОНОВИТИ СТАТУС ⚡", class: "btn-primary" %>
      <% end %>
    </div>
  </aside>

</div>