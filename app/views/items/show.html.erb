<div class="content-wrapper">
  <div style="margin-bottom: 20px;">
    <%= link_to '‚Üê –ù–∞–∑–∞–¥ –¥–æ –∫–∞—Ç–∞–ª–æ–≥—É', items_path, class: "nav-link", style: "color: var(--primary);" %>
  </div>

  <div class="item-detail-container" style="display: flex; gap: 40px; background: #3d3835; padding: 30px; border-radius: 12px; border: 1px solid var(--dark-brown);">
    
    <div class="item-visuals" style="flex: 1;">
      <div style="background: #2b2724; border-radius: 8px; min-height: 400px; display: flex; align-items: center; justify-content: center; border: 1px solid var(--muted);">

        <% if @item.image.attached? %>
          <%= image_tag @item.image, style: "max-width: 100%; height: auto; border-radius: 4px;" %>
        <% else %>
          <div style="text-align: center; color: var(--muted);">
            <span style="font-size: 4rem;">üé∏</span>
            <p>–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –æ—á—ñ–∫—É—î—Ç—å—Å—è</p>
          </div>
        <% end %>

      </div>
    </div>


    <div class="item-content" style="flex: 1; display: flex; flex-direction: column;">
      <h1 style="margin-top: 0; font-size: 2.5rem; color: var(--white);"><%= @item.name %></h1>
      

      <div style="margin-bottom: 20px;">
        <% @item.tags.each do |tag| %>
          <span style="display: inline-block; border: 1px solid var(--primary); color: var(--primary); padding: 2px 10px; border-radius: 4px; font-size: 0.8rem; margin-right: 8px;">
            #<%= tag.name %>
          </span> 
        <% end %>
      </div>

      <div style="font-size: 1.1rem; color: var(--text-muted); margin-bottom: 30px; flex-grow: 1;">
        <%= @item.description %> 
      </div>

      <div style="background: var(--bg-color); padding: 20px; border-radius: 8px; border: 1px solid var(--primary);">
        <div class="price" style="font-size: 2rem; margin-bottom: 10px;">
          <%= number_to_currency(@item.price, unit: "‚Ç¥", format: "%n %u") %> 
        </div>

        <div style="margin-bottom: 20px;">
          <% if @item.is_available %>
            <span style="color: #4CAF50;">‚óè –í –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ (<%= @item.quantity %> —à—Ç.)</span>
          <% else %>
            <span style="color: var(--primary);">‚óè –¢–∏–º—á–∞—Å–æ–≤–æ –≤—ñ–¥—Å—É—Ç–Ω—ñ–π</span>
          <% end %>
        </div>

          <% if @item.is_available %>
            <%= button_to cart_items_path(item_id: @item.id), 
                          method: :post, 
                          class: "btn-primary", 
                          data: { turbo: false },
                          style: "width: 100%; display: flex; align-items: center; justify-content: center; gap: 10px;" do %>
              <span>–î–û–î–ê–¢–ò –í –ö–û–®–ò–ö</span> üõí
            <% end %>
          <% end %>
      </div>
    </div>
  </div>

  <%# –°–µ–∫—Ü—ñ—è –≤—ñ–¥–≥—É–∫—ñ–≤ (–í–∏–º–æ–≥–∞ 3.1.8) %>
<%# –°–µ–∫—Ü—ñ—è –≤—ñ–¥–≥—É–∫—ñ–≤ %>
<div class="reviews-container" style="margin-top: 50px; border-top: 1px solid var(--dark-brown); padding-top: 30px;">
  <h2 style="color: var(--primary); margin-bottom: 20px;">–í–Ü–î–ì–£–ö–ò –¢–ê –í–†–ê–ñ–ï–ù–ù–Ø üé∏</h2>

  <% if user_signed_in? %>
    <%# –§–æ—Ä–º–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤—ñ–¥–≥—É–∫—É %>
    <div class="item-card" style="padding: 20px; margin-bottom: 40px; background: #2b2724;">
      <h4 style="margin-top: 0;">–ó–∞–ª–∏—à–∏—Ç–∏ —Å–≤—ñ–π –≤—ñ–¥–≥—É–∫:</h4>
      <%= form_with(model: [ @item, @item.reviews.build ], local: true) do |f| %>
        
        <div style="margin-bottom: 15px;">
          <%= f.label :rating, "–í–∞—à–∞ –æ—Ü—ñ–Ω–∫–∞:", style: "display: block; color: var(--primary); margin-bottom: 5px;" %>
          <%= f.select :rating, (1..5).to_a.reverse.map { |n| ["#{n} ‚òÖ", n] }, {}, 
              { style: "background: #332f2c; color: white; border: 1px solid var(--muted); padding: 8px; border-radius: 4px; width: 100px;" } %>
        </div>

        <div style="margin-bottom: 15px;">
          <%= f.text_area :comment, placeholder: "–ù–∞–ø–∏—à—ñ—Ç—å –≤–∞—à—ñ –≤—Ä–∞–∂–µ–Ω–Ω—è –≤—ñ–¥ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É...", 
              style: "width: 100%; height: 100px; background: #332f2c; color: white; border: 1px solid var(--muted); padding: 12px; border-radius: 6px; resize: vertical;" %>
        </div>

        <%= f.submit "–û–ü–£–ë–õ–Ü–ö–£–í–ê–¢–ò", class: "btn-primary", style: "padding: 10px 25px;" %>
      <% end %>
    </div>
  <% else %>
    <p style="background: rgba(207, 109, 55, 0.1); padding: 15px; border-radius: 8px; border: 1px dashed var(--primary); text-align: center;">
      –¢—ñ–ª—å–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ñ —Ä–æ–∫-—Ñ–∞–Ω–∞—Ç–∏ –º–æ–∂—É—Ç—å –∑–∞–ª–∏—à–∞—Ç–∏ –≤—ñ–¥–≥—É–∫–∏. <%= link_to "–£–≤—ñ–π—Ç–∏", new_user_session_path, style: "color: var(--primary); font-weight: bold;" %>
    </p>
  <% end %>

  <div class="reviews-list">
    <% if @item.reviews.any? %>
      <% @item.reviews.order(created_at: :desc).each do |review| %>
        <% if review.persisted? %>
          <div style="background: #2b2724; padding: 20px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid var(--primary);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
              <strong><%= review.user.email.split('@').first %></strong>
              <span style="color: var(--primary); font-weight: bold;"><%= "‚òÖ" * review.rating %></span>
            </div>
            <p style="margin: 0; color: #ccc;"><%= review.details %></p>
            <small style="color: var(--muted); display: block; margin-top: 10px;">–û–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ: <%= review.created_at.strftime("%d.%m.%Y") %></small>
          </div>
        <% end %>
      <% end %>
    <% else %>
      <p style="color: var(--muted); text-align: center;">–ù–∞ —Ü–µ–π —Ç–æ–≤–∞—Ä —â–µ –Ω–µ–º–∞—î –≤—ñ–¥–≥—É–∫—ñ–≤. –°—Ç–∞–Ω—å—Ç–µ –ø–µ—Ä—à–∏–º!</p>
    <% end %>
  </div>
</div>
</div>