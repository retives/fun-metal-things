<div class="content-wrapper">
  <div class="page-actions" style="margin-bottom: 20px;">
    <%= link_to '‚Üê –ù–∞–∑–∞–¥ –¥–æ –∫–∞—Ç–∞–ª–æ–≥—É', items_path, class: "nav-link admin-link" %>
  </div>

  <div class="item-detail-container">
    <div class="item-visuals">
      <div class="item-thumb">
        <% if @item.image.attached? %>
          <%= image_tag @item.image, class: "logo-img" %>
        <% else %>
          <div style="text-align: center; color: var(--muted);">
            <span style="font-size: 4rem;">üé∏</span>
            <p>–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –æ—á—ñ–∫—É—î—Ç—å—Å—è</p>
          </div>
        <% end %>
      </div>
    </div>

    <div class="item-content">
      <h1 class="item-title"><%= @item.name %></h1>

      <div>
        <% @item.tags.each do |tag| %>
          <span class="tag-badge">#<%= tag.name %></span>
        <% end %>
      </div>

      <div class="item-description">
        <%= @item.description %>
      </div>

      <div class="item-price-box">
        <div class="price">
          <%= number_to_currency(@item.price, unit: "‚Ç¥", format: "%n %u") %>
        </div>

        <div class="item-availability">
          <% if @item.is_available %>
            <span class="status-available">‚óè –í –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ (<%= @item.quantity %> —à—Ç.)</span>
          <% else %>
            <span class="status-unavailable">‚óè –¢–∏–º—á–∞—Å–æ–≤–æ –≤—ñ–¥—Å—É—Ç–Ω—ñ–π</span>
          <% end %>
        </div>

        <% if @item.is_available %>
          <%= button_to cart_items_path(item_id: @item.id), method: :post, class: "btn-primary btn-block", data: { turbo: false } do %>
            <span>–î–û–î–ê–¢–ò –í –ö–û–®–ò–ö</span> üõí
          <% end %>
        <% end %>
      </div>
    </div>
  </div>

  <%# –°–µ–∫—Ü—ñ—è –≤—ñ–¥–≥—É–∫—ñ–≤ (–í–∏–º–æ–≥–∞ 3.1.8) %>
<%# –°–µ–∫—Ü—ñ—è –≤—ñ–¥–≥—É–∫—ñ–≤ %>
<div class="reviews-container">
  <h2 class="reviews-title">–í–Ü–î–ì–£–ö–ò –¢–ê –í–†–ê–ñ–ï–ù–ù–Ø üé∏</h2>

  <% if user_signed_in? %>
    <%# –§–æ—Ä–º–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤—ñ–¥–≥—É–∫—É %>
    <div class="item-card" style="padding: 20px; margin-bottom: 40px; background: #2b2724;">
      <h4 style="margin-top: 0;">–ó–∞–ª–∏—à–∏—Ç–∏ —Å–≤—ñ–π –≤—ñ–¥–≥—É–∫:</h4>
      <%= form_with(model: [ @item, @item.reviews.build ], local: true) do |f| %>
        
        <div>
          <%= f.label :rating, "–í–∞—à–∞ –æ—Ü—ñ–Ω–∫–∞:", class: "form-label" %>
          <%= f.select :rating, (1..5).to_a.reverse.map { |n| ["#{n} ‚òÖ", n] }, {}, { class: "form-control form-control--select" } %>
        </div>

        <div>
          <%= f.text_area :comment, placeholder: "–ù–∞–ø–∏—à—ñ—Ç—å –≤–∞—à—ñ –≤—Ä–∞–∂–µ–Ω–Ω—è –≤—ñ–¥ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É...", class: "form-control" %>
        </div>

        <%= f.submit "–û–ü–£–ë–õ–Ü–ö–£–í–ê–¢–ò", class: "btn-primary" %>
      <% end %>
    </div>
  <% else %>
    <p style="background: rgba(207, 109, 55, 0.1); padding: 15px; border-radius: 8px; border: 1px dashed var(--primary); text-align: center;">
      –¢—ñ–ª—å–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ñ —Ä–æ–∫-—Ñ–∞–Ω–∞—Ç–∏ –º–æ–∂—É—Ç—å –∑–∞–ª–∏—à–∞—Ç–∏ –≤—ñ–¥–≥—É–∫–∏. <%= link_to "–£–≤—ñ–π—Ç–∏", new_user_session_path, style: "color: var(--primary); font-weight: bold;" %>
    </p>
  <% end %>

  <div class="reviews-list">
    <% if @item.reviews.any? %>
      <% @item.reviews.order(created_at: :desc).each do |review| %>
          <% if review.persisted? %>
          <div class="review-card">
            <div class="review-meta">
              <strong><%= review.user.email.split('@').first %></strong>
              <span class="status-available"><%= "‚òÖ" * review.rating %></span>
            </div>
            <p class="review-text"><%= review.details %></p>
            <small class="muted" style="display: block; margin-top: 10px;">–û–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ: <%= review.created_at.strftime("%d.%m.%Y") %></small>
          </div>
        <% end %>
      <% end %>
    <% else %>
      <p style="color: var(--muted); text-align: center;">–ù–∞ —Ü–µ–π —Ç–æ–≤–∞—Ä —â–µ –Ω–µ–º–∞—î –≤—ñ–¥–≥—É–∫—ñ–≤. –°—Ç–∞–Ω—å—Ç–µ –ø–µ—Ä—à–∏–º!</p>
    <% end %>
  </div>
</div>
</div>